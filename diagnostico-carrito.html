<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagnóstico del Carrito - Mundo Calzado</title>
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/standardized-cards.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/new-colors.css">
  <link rel="stylesheet" href="css/enhanced-shopping.css">
  <link rel="stylesheet" href="css/carrito.css">
  <link rel="stylesheet" href="css/carrito-enhanced.css">
  <link rel="stylesheet" href="css/image-size-fix.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
      background-color: #f5f5f5;
    }
    h1, h2, h3 {
      color: var(--color-primario);
    }
    h1 {
      border-bottom: 2px solid var(--color-primario);
      padding-bottom: 10px;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .btn {
      background-color: #003366;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    .btn:hover {
      background-color: #004488;
    }
    .results {
      background-color: #f5f5f5;
      padding: 16px;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
      height: 300px;
      overflow-y: auto;
      margin-top: 16px;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    .info {
      color: blue;
    }
    .control-panel {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-indicator.green {
      background-color: green;
    }
    .status-indicator.red {
      background-color: red;
    }
    .status-indicator.orange {
      background-color: orange;
    }
    .top-nav {
      background-color: #003366;
      padding: 10px;
      margin: -20px -20px 20px -20px;
      color: white;
      text-align: center;
    }
    .top-nav a {
      color: white;
      text-decoration: none;
      margin: 0 15px;
    }
    .top-nav a:hover {
      text-decoration: underline;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/image-size-fix.css">
</head>
<body>
  <div class="top-nav">
    <a href="index.html">Inicio</a>
    <a href="hombres.html">Hombres</a>
    <a href="mujeres.html">Mujeres</a>
    <a href="ninos.html">Niños</a>
    <a href="ninas.html">Niñas</a>
  </div>

  <h1>Herramienta de Diagnóstico del Carrito</h1>
  
  <div class="card">
    <h2>Estado Actual</h2>
    <p><span class="status-indicator" id="status-general"></span> <span id="status-text">Ejecutando diagnóstico...</span></p>
    
    <div class="control-panel">
      <button class="btn" id="btn-ejecutar">Ejecutar Diagnóstico</button>
      <button class="btn" id="btn-agregar-test">Añadir Producto de Prueba</button>
      <button class="btn" id="btn-limpiar">Limpiar Carrito</button>
      <button class="btn" id="btn-verificar-js">Verificar Scripts</button>
      <button class="btn" id="btn-abrir-consola">Mostrar Consola</button>
    </div>
  </div>
  
  <div class="card">
    <h2>Diagnóstico</h2>
    <p>Resultados del diagnóstico del carrito:</p>
    <div class="results" id="results">Esperando diagnóstico...</div>
  </div>
  
  <div class="card">
    <h2>Datos del Carrito</h2>
    <p>Contenido actual del carrito:</p>
    <div class="results" id="carrito-data">Esperando datos...</div>
  </div>
  
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const resultsEl = document.getElementById('results');
      const carritoDataEl = document.getElementById('carrito-data');
      const statusGeneral = document.getElementById('status-general');
      const statusText = document.getElementById('status-text');
      
      // Función para formatear la salida de consola
      function formatOutput(message, type) {
        const now = new Date();
        const time = now.toLocaleTimeString();
        return `[${time}] ${type ? type + ': ' : ''}${message}\n`;
      }
      
      // Función para mostrar datos del carrito
      function mostrarDatosCarrito() {
        try {
          const carritoData = localStorage.getItem('carrito');
          if (carritoData) {
            const carrito = JSON.parse(carritoData);
            carritoDataEl.textContent = JSON.stringify(carrito, null, 2);
          } else {
            carritoDataEl.textContent = 'El carrito está vacío';
          }
        } catch (e) {
          carritoDataEl.textContent = 'Error al leer datos del carrito: ' + e.message;
        }
      }
      
      // Sobrescribir console.log y console.error para mostrar en nuestra UI
      const oldLog = console.log;
      const oldError = console.error;
      
      console.log = function(message) {
        oldLog.apply(console, arguments);
        if (typeof message === 'object') message = JSON.stringify(message, null, 2);
        resultsEl.textContent += formatOutput(message);
        resultsEl.scrollTop = resultsEl.scrollHeight;
      };
      
      console.error = function(message) {
        oldError.apply(console, arguments);
        if (typeof message === 'object') message = JSON.stringify(message, null, 2);
        resultsEl.textContent += formatOutput(message, 'ERROR');
        resultsEl.scrollTop = resultsEl.scrollHeight;
      };
      
      // Verificar estado global
      function verificarEstadoGlobal() {
        const resultados = {
          carritoJsCargado: typeof window.diagnosticoCarrito !== 'undefined' && window.diagnosticoCarrito.verificarCarritoJsCargado(),
          elementosDisponibles: window.diagnosticoCarrito && window.diagnosticoCarrito.verificarElementosCarrito(),
          localStorageOk: window.diagnosticoCarrito && window.diagnosticoCarrito.verificarLocalStorage(),
          datosCarritoOk: window.diagnosticoCarrito && window.diagnosticoCarrito.verificarDatosCarrito(),
          botonesOk: window.diagnosticoCarrito && window.diagnosticoCarrito.verificarBotonesAgregarCarrito()
        };
        
        const todoCorrecto = Object.values(resultados).every(v => v === true);
        
        if (todoCorrecto) {
          statusGeneral.className = 'status-indicator green';
          statusText.textContent = 'Todo parece estar funcionando correctamente';
          statusText.className = 'success';
        } else if (typeof window.diagnosticoCarrito === 'undefined') {
          statusGeneral.className = 'status-indicator red';
          statusText.textContent = 'Error crítico: carrito-debug.js no se ha cargado correctamente';
          statusText.className = 'error';
        } else {
          statusGeneral.className = 'status-indicator orange';
          statusText.textContent = 'Se encontraron problemas - Ver diagnóstico para detalles';
          statusText.className = 'error';
        }
      }
      
      // Ejecutar diagnóstico
      document.getElementById('btn-ejecutar').addEventListener('click', function() {
        resultsEl.textContent = '';
        console.log('Iniciando diagnóstico completo...');
        
        if (typeof window.diagnosticoCarrito === 'undefined') {
          console.error('Error crítico: carrito-debug.js no se ha cargado correctamente');
          return;
        }
        
        window.diagnosticoCarrito.verificarCarritoJsCargado();
        window.diagnosticoCarrito.verificarElementosCarrito();
        window.diagnosticoCarrito.verificarLocalStorage();
        window.diagnosticoCarrito.verificarDatosCarrito();
        window.diagnosticoCarrito.verificarBotonesAgregarCarrito();
        
        console.log('Diagnóstico completo finalizado');
        verificarEstadoGlobal();
        mostrarDatosCarrito();
      });
      
      // Agregar producto de prueba
      document.getElementById('btn-agregar-test').addEventListener('click', function() {
        resultsEl.textContent = '';
        console.log('Intentando agregar producto de prueba...');
        
        if (typeof window.diagnosticoCarrito === 'undefined') {
          console.error('Error crítico: carrito-debug.js no se ha cargado correctamente');
          return;
        }
        
        const resultado = window.diagnosticoCarrito.testAgregarProducto();
        if (resultado) {
          console.log('✓ Producto de prueba agregado correctamente');
        } else {
          console.error('✗ No se pudo agregar el producto de prueba');
        }
        
        mostrarDatosCarrito();
      });
      
      // Limpiar carrito
      document.getElementById('btn-limpiar').addEventListener('click', function() {
        if (confirm('¿Estás seguro de que quieres eliminar todos los productos del carrito?')) {
          localStorage.removeItem('carrito');
          console.log('Carrito eliminado correctamente');
          mostrarDatosCarrito();
        }
      });
      
      // Verificar scripts cargados
      document.getElementById('btn-verificar-js').addEventListener('click', function() {
        resultsEl.textContent = '';
        console.log('Verificando scripts cargados...');
        
        const scripts = document.querySelectorAll('script');
        console.log(`Total de scripts cargados: ${scripts.length}`);
        
        scripts.forEach(script => {
          if (script.src) {
            console.log(`✓ Script externo: ${script.src}`);
          } else {
            console.log(`✓ Script inline: ${script.textContent.substring(0, 30)}...`);
          }
        });
      });
      
      // Botón para abrir consola del navegador
      document.getElementById('btn-abrir-consola').addEventListener('click', function() {
        console.log('Por favor, abre la consola del navegador presionando F12 o Ctrl+Shift+J (Windows/Linux) o Cmd+Option+J (Mac)');
        alert('Por favor, abre la consola del navegador presionando F12 o Ctrl+Shift+J (Windows/Linux) o Cmd+Option+J (Mac)');
      });
      
      // Inicializar
      verificarEstadoGlobal();
      mostrarDatosCarrito();
      
    });
  </script>
  
  <!-- Productos de prueba -->
  <div class="card" id="productos-prueba">
    <h2>Productos de prueba</h2>
    <p>Use estos productos para verificar que no se agreguen duplicados al carrito:</p>
    
    <div class="catalogo-container" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px;">
      <!-- Producto de prueba 1 -->
      <div class="producto-card">
        <div class="img-container">
          <img src="assets/img/calzhombres/4.jpeg" alt="Zapato Hombre Test 1">
        </div>
        <div class="producto-info">
          <h3>Zapato Hombre Test</h3>
          <p class="producto-precio">$75.000</p>
          <div class="producto-tallas">
            <div class="tallas-label">Selecciona tu talla:</div>
            <div class="tallas-list">
              <button type="button" class="talla-btn">38</button>
              <button type="button" class="talla-btn">39</button>
              <button type="button" class="talla-btn">40</button>
            </div>
          </div>
          <button class="btn-add-cart">Añadir al carrito</button>
        </div>
      </div>
      
      <!-- Producto de prueba 2 -->
      <div class="producto-card">
        <div class="img-container">
          <img src="assets/img/calzmujeres/m1.jpeg" alt="Zapato Mujer Test">
        </div>
        <div class="producto-info">
          <h3>Zapato Mujer Test</h3>
          <p class="producto-precio">$85.000</p>
          <div class="producto-tallas">
            <div class="tallas-label">Selecciona tu talla:</div>
            <div class="tallas-list">
              <button type="button" class="talla-btn">35</button>
              <button type="button" class="talla-btn">36</button>
              <button type="button" class="talla-btn">37</button>
            </div>
          </div>
          <button class="btn-add-cart">Añadir al carrito</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal del carrito -->
  <div id="modal-carrito" class="modal-carrito oculto">
    <div class="modal-carrito-content">
      <div class="modal-carrito-header">
        <span class="modal-carrito-title"><i class="fa-solid fa-cart-shopping"></i> MI CARRITO</span>
        <button id="cerrar-carrito" class="cerrar-carrito">&times;</button>
      </div>
      <div id="carrito-lista" class="carrito-lista">
        <!-- Aquí se mostrarán los productos del carrito -->
      </div>
      <div id="carrito-vacio" class="carrito-vacio">
        <div class="carrito-vacio-icon">
          <i class="fa-solid fa-box-open fa-4x carrito-vacio-icon-color"></i>
        </div>
        <p class="carrito-vacio-txt">Tu carrito está vacío</p>
        <p class="carrito-vacio-desc">Aún no tienes artículos en tu carrito de compra.</p>
        <button id="btn-elegir-productos" class="btn-elegir-productos"><i class="fa-solid fa-shoe-prints"></i> Explorar productos</button>
      </div>
      <div id="carrito-total" class="carrito-total oculto">
        <span>Total: $<span id="carrito-total-precio">0</span></span>
        <button id="btn-finalizar-compra" class="btn-finalizar-compra"><i class="fa-solid fa-check"></i> Finalizar compra</button>
      </div>
    </div>
  </div>
  
  <script src="js/tallas.js"></script>
  
  // Ejecutar diagnóstico automáticamente al cargar
      setTimeout(function() {
        document.getElementById('btn-ejecutar').click();
      }, 500);
    });
  </script>
    <script src="./js/image-size-fix.js"></script>
</body>
</html>
