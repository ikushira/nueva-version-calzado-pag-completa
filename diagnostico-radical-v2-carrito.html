<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagnóstico Radical V2 del Carrito</title>
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/standardized-cards.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/new-colors.css">
  <link rel="stylesheet" href="css/enhanced-shopping.css">
  <link rel="stylesheet" href="css/carrito.css">
  <link rel="stylesheet" href="css/carrito-enhanced.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #ff0000;
      border-bottom: 2px solid #ff0000;
      padding-bottom: 10px;
    }
    .diagnostico-panel {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .info-panel {
      background-color: #e6f7ff;
      border: 1px solid #91d5ff;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    .test-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }
    .test-card {
      flex: 1;
      min-width: 300px;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      position: relative;
    }
    .test-actions {
      margin-top: 15px;
      display: flex;
      justify-content: space-between;
    }
    .btn-test {
      background-color: #ff0000;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-test:hover {
      background-color: #cc0000;
    }
    .log-panel {
      background-color: #212121;
      color: #ffffff;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      height: 300px;
      overflow-y: auto;
    }
    .log-entry {
      margin: 5px 0;
      word-break: break-word;
      line-height: 1.4;
    }
    .success {
      color: #4CAF50;
    }
    .warning {
      color: #FFC107;
    }
    .error {
      color: #F44336;
    }
    .info {
      color: #2196F3;
    }
    .resultado-test {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      background-color: #f0f0f0;
    }
    .producto-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      max-width: 300px;
    }
    .producto-titulo {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .producto-precio {
      font-size: 16px;
      color: #ff0000;
      margin-bottom: 10px;
    }
    .producto-tallas {
      display: flex;
      gap: 5px;
      margin-bottom: 15px;
    }
    .talla-btn {
      padding: 5px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    .talla-btn.seleccionada {
      background-color: #ff0000;
      color: white;
      border-color: #ff0000;
    }
    #status {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      border-radius: 4px;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <!-- Header y navegación simplificada -->
  <div class="top-bar red-theme">
    <div class="promo">
      <span class="promo-strong"><i class="fa-solid fa-fire"></i> DIAGNÓSTICO DEL CARRITO</span>
    </div>
  </div>
  <header class="main-header red-theme">
    <div class="logo">MUNDO CALZADO</div>
    <div class="header-actions">
      <button id="btn-carrito" class="btn-carrito">
        <i class="fa-solid fa-cart-shopping"></i>
        <span>Carrito de compras</span>
        <span id="carrito-cantidad" class="carrito-cantidad">0</span>
      </button>
    </div>
  </header>
  
  <!-- Modal Carrito de Compras -->
  <div id="modal-carrito" class="modal-carrito oculto">
    <div class="modal-carrito-content">
      <div class="modal-carrito-header">
        <span class="modal-carrito-title"><i class="fa-solid fa-cart-shopping"></i> MI CARRITO</span>
        <button id="cerrar-carrito" class="cerrar-carrito">&times;</button>
      </div>
      <div id="carrito-lista" class="carrito-lista">
        <!-- Aquí se mostrarán los productos del carrito -->
      </div>
      <div id="carrito-vacio" class="carrito-vacio">
        <div class="carrito-vacio-icon">
          <i class="fa-solid fa-box-open fa-4x carrito-vacio-icon-color"></i>
        </div>
        <p class="carrito-vacio-txt">Tu carrito está vacío</p>
        <p class="carrito-vacio-desc">Aún no tienes artículos en tu carrito de compra.</p>
        <button id="btn-elegir-productos" class="btn-elegir-productos"><i class="fa-solid fa-shoe-prints"></i> Explorar productos</button>
      </div>
      <div id="carrito-total" class="carrito-total oculto">
        <span>Total: $<span id="carrito-total-precio">0</span></span>
        <button id="btn-finalizar-compra" class="btn-finalizar-compra"><i class="fa-solid fa-check"></i> Finalizar compra</button>
      </div>
    </div>
  </div>

  <div id="status"></div>

  <h1>Diagnóstico Radical V2 del Carrito</h1>

  <div class="info-panel">
    <h2>Información del Sistema</h2>
    <div id="sistema-info">
      <p><strong>Navegador:</strong> <span id="navegador-info"></span></p>
      <p><strong>Scripts Cargados:</strong></p>
      <div id="scripts-cargados"></div>
    </div>
  </div>

  <div class="diagnostico-panel">
    <h2>Estado Actual del Carrito</h2>
    <div id="estado-carrito">
      <p><strong>Productos en carrito:</strong> <span id="num-productos">0</span></p>
      <p><strong>Contenido:</strong></p>
      <pre id="contenido-carrito">[]</pre>
    </div>
    <div class="test-actions">
      <button id="btn-limpiar-carrito" class="btn-test">Limpiar Carrito</button>
      <button id="btn-refrescar-carrito" class="btn-test">Refrescar Estado</button>
    </div>
  </div>

  <div class="test-panel">
    <div class="test-card">
      <h3>Producto de Prueba</h3>
      <div class="producto-card">
        <h3 class="producto-titulo">Zapato de Prueba</h3>
        <div class="producto-precio">$150,000</div>
        <div class="producto-tallas">
          <span class="talla-btn">36</span>
          <span class="talla-btn">37</span>
          <span class="talla-btn">38</span>
          <span class="talla-btn">39</span>
          <span class="talla-btn">40</span>
        </div>
        <button class="btn-agregar-carrito">Añadir al carrito</button>
      </div>
      <div class="resultado-test" id="resultado-prueba1"></div>
    </div>

    <div class="test-card">
      <h3>Diagnóstico</h3>
      <p>Análisis del carrito y eventos:</p>
      <div class="test-actions">
        <button id="btn-comprobar-eventos" class="btn-test">Comprobar Eventos</button>
        <button id="btn-diagnosticar" class="btn-test">Diagnosticar Sistema</button>
      </div>
      <div class="resultado-test" id="resultado-diagnostico"></div>
    </div>
  </div>

  <div class="log-panel" id="log-panel">
    <div class="log-entry info">Esperando acciones...</div>
  </div>

  <!-- Scripts -->
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Mostrar información del navegador
      document.getElementById('navegador-info').textContent = navigator.userAgent;
      
      // Mostrar scripts cargados
      const scriptsDiv = document.getElementById('scripts-cargados');
      const scripts = document.querySelectorAll('script');
      let html = '<ul>';
      let tieneCarrito = false;
      let tieneFixRadical = false;
      let tieneFixRadicalV2 = false;
      
      scripts.forEach(script => {
          if (script.src) {
              html += `<li>${script.src.split('/').pop()}</li>`;
              if (script.src && script.src.includes('carrito.js')) tieneCarrito = true;
              if (script.src && script.src.includes('carrito-fix-radical.js')) tieneFixRadical = true;
              if (script.src && script.src.includes('carrito-fix-radical-v2.js')) tieneFixRadicalV2 = true;
          }
      });
      html += '</ul>';
      
      html += `
        <p><strong>carrito.js:</strong> ${tieneCarrito ? '✅ Cargado' : '❌ No cargado'}</p>
        <p><strong>carrito-fix-radical.js:</strong> ${tieneFixRadical ? '✅ Cargado' : '❌ No cargado'}</p>
        <p><strong>carrito-fix-radical-v2.js:</strong> ${tieneFixRadicalV2 ? '✅ Cargado' : '❌ No cargado'}</p>
      `;
      
      scriptsDiv.innerHTML = html;
      
      // Funciones de logging
      function log(message, type = 'info') {
          const logPanel = document.getElementById('log-panel');
          const entry = document.createElement('div');
          entry.className = `log-entry ${type}`;
          entry.textContent = message;
          logPanel.appendChild(entry);
          logPanel.scrollTop = logPanel.scrollHeight;
      }
      
      // Capturar logs de consola
      const originalConsoleLog = console.log;
      const originalConsoleError = console.error;
      const originalConsoleWarn = console.warn;
      
      console.log = function() {
          originalConsoleLog.apply(console, arguments);
          log(Array.from(arguments).join(' '));
      };
      
      console.error = function() {
          originalConsoleError.apply(console, arguments);
          log(Array.from(arguments).join(' '), 'error');
      };
      
      console.warn = function() {
          originalConsoleWarn.apply(console, arguments);
          log(Array.from(arguments).join(' '), 'warning');
      };
      
      // Mostrar estado del carrito
      function actualizarEstadoCarrito() {
          const numProductos = document.getElementById('num-productos');
          const contenidoCarrito = document.getElementById('contenido-carrito');
          
          if (window.carrito) {
              numProductos.textContent = window.carrito.length;
              contenidoCarrito.textContent = JSON.stringify(window.carrito, null, 2);
          } else {
              numProductos.textContent = '0';
              contenidoCarrito.textContent = 'No se encontró variable carrito';
          }
      }
      
      // Botón limpiar carrito
      document.getElementById('btn-limpiar-carrito').addEventListener('click', function() {
          if (window.carrito) {
              window.carrito = [];
              localStorage.setItem('carrito', '[]');
              
              if (window.actualizarCantidadCarrito) {
                  window.actualizarCantidadCarrito();
              }
              
              log('Carrito limpiado completamente', 'success');
              actualizarEstadoCarrito();
              mostrarStatus('Carrito limpiado');
          } else {
              log('No se encontró variable carrito', 'error');
          }
      });
      
      // Botón refrescar carrito
      document.getElementById('btn-refrescar-carrito').addEventListener('click', function() {
          log('Refrescando estado del carrito', 'info');
          actualizarEstadoCarrito();
          mostrarStatus('Estado actualizado');
      });
      
      // Botones de talla
      const tallasBtns = document.querySelectorAll('.talla-btn');
      tallasBtns.forEach(btn => {
          btn.addEventListener('click', function() {
              // Quitar selección anterior
              tallasBtns.forEach(b => b.classList.remove('seleccionada'));
              // Seleccionar nueva talla
              this.classList.add('seleccionada');
              log(`Talla seleccionada: ${this.textContent}`, 'info');
          });
      });

      // Botón diagnóstico
      document.getElementById('btn-diagnosticar').addEventListener('click', function() {
          const resultadoDiagnostico = document.getElementById('resultado-diagnostico');
          
          log('Iniciando diagnóstico completo del sistema', 'info');
          
          let html = '<h4>Resultados del diagnóstico:</h4><ul>';
          
          // Verificar scripts cargados
          html += `<li>carrito.js: ${tieneCarrito ? '✅' : '❌'}</li>`;
          html += `<li>carrito-fix-radical.js: ${tieneFixRadical ? '✅' : '❌'}</li>`;
          html += `<li>carrito-fix-radical-v2.js: ${tieneFixRadicalV2 ? '✅' : '❌'}</li>`;
          
          // Verificar variable carrito
          if (window.carrito) {
              html += `<li>Variable carrito: ✅ (${window.carrito.length} productos)</li>`;
          } else {
              html += `<li>Variable carrito: ❌ No encontrada</li>`;
          }
          
          // Verificar funciones
          html += `<li>inicializarCarrito: ${typeof window.inicializarCarrito === 'function' ? '✅' : '❌'}</li>`;
          html += `<li>agregarAlCarrito: ${typeof window.agregarAlCarrito === 'function' ? '✅' : '❌'}</li>`;
          html += `<li>actualizarCantidadCarrito: ${typeof window.actualizarCantidadCarrito === 'function' ? '✅' : '❌'}</li>`;
          
          html += '</ul>';
          
          // Conclusión
          if (tieneFixRadicalV2) {
              html += '<p class="success">✅ El sistema está utilizando la solución Radical V2</p>';
          } else if (tieneFixRadical) {
              html += '<p class="warning">⚠️ El sistema está utilizando la solución Radical V1 (desactualizada)</p>';
          } else if (tieneCarrito) {
              html += '<p class="warning">⚠️ El sistema está utilizando solo el carrito básico sin correcciones</p>';
          } else {
              html += '<p class="error">❌ No se detectó ningún sistema de carrito funcionando</p>';
          }
          
          resultadoDiagnostico.innerHTML = html;
          log('Diagnóstico completado', 'success');
          mostrarStatus('Diagnóstico completado');
      });
      
      // Comprobar eventos
      document.getElementById('btn-comprobar-eventos').addEventListener('click', function() {
          const resultadoDiagnostico = document.getElementById('resultado-diagnostico');
          
          log('Comprobando listeners de eventos en botones', 'info');
          
          const boton = document.querySelector('.btn-agregar-carrito');
          let eventosTotales = 0;
          
          if (!boton) {
              resultadoDiagnostico.innerHTML = '<p class="error">No se encontró ningún botón para analizar</p>';
              return;
          }
          
          // Verificar si tiene dataset para el sistema radical
          const tieneRadicalV2 = boton.dataset.procesadoRadicalV2 === 'true';
          const tieneRadicalV1 = boton.dataset.procesadoRadical === 'true';
          const tieneBasico = boton.dataset.carritoEnlazado === 'true';
          
          let html = '<h4>Resultados del análisis de eventos:</h4><ul>';
          
          html += `<li>Marcado por sistema Radical V2: ${tieneRadicalV2 ? '✅' : '❌'}</li>`;
          html += `<li>Marcado por sistema Radical V1: ${tieneRadicalV1 ? '✅' : '❌'}</li>`;
          html += `<li>Marcado por sistema básico: ${tieneBasico ? '✅' : '❌'}</li>`;
          
          // Verificar listeners globales
          html += `<li>Listener global de clicks: ✅</li>`;
          
          // Conclusión
          if (tieneRadicalV2) {
              html += '<p class="success">✅ El botón está correctamente configurado con el sistema Radical V2</p>';
          } else if (tieneRadicalV1) {
              html += '<p class="warning">⚠️ El botón está configurado con el sistema Radical V1 (desactualizado)</p>';
          } else if (tieneBasico) {
              html += '<p class="warning">⚠️ El botón está configurado solo con el sistema básico</p>';
          } else {
              html += '<p class="error">❌ El botón no está configurado con ningún sistema conocido</p>';
          }
          
          resultadoDiagnostico.innerHTML = html;
          log('Análisis de eventos completado', 'success');
          mostrarStatus('Análisis completado');
      });
      
      // Función para mostrar estado temporal
      function mostrarStatus(mensaje) {
          const status = document.getElementById('status');
          status.textContent = mensaje;
          status.style.display = 'block';
          
          setTimeout(() => {
              status.style.display = 'none';
          }, 2000);
      }
      
      // Inicializar
      actualizarEstadoCarrito();
      log('Página de diagnóstico cargada', 'success');
      
      // Registrar el estado del carrito en LocalStorage
      const carritoEnLS = localStorage.getItem('carrito');
      log(`Carrito en LocalStorage: ${carritoEnLS}`, 'info');
    });
  </script>
</body>
</html>
